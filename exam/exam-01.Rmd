---
title: "Exam 01"
subtitle: "Women's Soccer"
date: "due Thursday, October 6, 11:59pm"
output: 
  tufte::tufte_html:
    css: "hw.css"
    tufte_variant: "envisioned"
    highlight: pygments
    toc: true
    toc_depth: 1
link-citations: yes
editor_options: 
  markdown: 
    wrap: sentence
---

# Goals

This Exam will assess the following skills:

+ Data wrangling
+ Data visualization
+ Clarity of code and written communication 
+ Ability to use data to investigate questions

# Getting started

+ Login to your RStudio Cloud account
+ Navigate to the `MATH_250_individual` workspace 
+ Launch the `Exam1` project
+ Open `Exam1.Rmd`

# Packages

We will use the **tidyverse**, **ggridges**, and **nwslR** packages for this analysis. You may also choose to use **kableExtra** for formatting tables.

```{r load-package, eval = FALSE}
library(nwslR)
library(tidyverse)
library(ggridges)
```

# Data: The Portland Thorns FC

For this exam, you will be working with data from the [Portland Thorns FC ](https://www.nwslsoccer.com/team/portland-thorns-fc/stats), a National Women's Soccer League (NWSL) Team in Portland, OR. In 2021, the Thorns won the NWSL Challenge Cup, the Women's International Champions Cup, and the NWSL Shield. Data for this exam was sourced from the [nwslR package](https://github.com/adror1/nwslR). 

The package comes with 7 different datasets, but you will be working primarily with the `game` dataset, which includes the results of all NWSL games played from 2015 - 2019 (not just Portland Thorns games). The variables in the `game` dataset are as follows:

- `game_id`: an ID for the game that identifies the teams and the date.
- `game_date`: the date of the game
- `home_team`: home team id
- `away_team`: away team id
- `home_pts`: the number of points scored by the home team
- `away_pts`: the number of points scored by the away team
- `winner`: team id for winning team, if applicable. If tied, NA
- `season`: the season the game took place in (e.g., 2017, 2018, 2019)

You can view the documentation for this dataset by running `?game` in the console. 

Running the following code will make `game` appear in your Environment.

```{r}
game <- nwslR::game
```

While not required to use the other 6 datasets from the `nwslR` package, you might find it useful to poke around in them. For example, the `franchise` dataset gives the full team names and locations, not just their ids.  

# Exercises 

All plots should follow the best visualization practices discussed in lecture, including an informative title, labeled axes, and careful consideration of aesthetic choices. Your encouraged (but not required) to use the viridis color palette. 

All code should follow the tidyverse style guidelines.

1. How many rows are in the `game` dataset? How many columns? What does each row represent?

Before beginning the analysis, you will need to conduct some data wrangling to look only at the Portland Thorns data.

2. Create a new dataset called `portland` that contains only the games the Portland Thorns played in. Confirm that there are 118 in this dataset before continuing. 

3. Create three new variables, `POR_points` (the number of points Portland scored), `OPP_points` (the number of points the opponent scored), and `result` (a categorical variable for whether the result was a `Win`, `Loss`, or `Tie` for Portland). *Hint: `if_else()` and `case_when()` will be helpful*. 

4. Create a bar chart to visualize the distribution of the `result` of the games. Include a clear title and axis labels. What outcome occurred most frequently?

5. Create an appropriate visualization to examine how the Thorns performed in each individual season (in terms of wins, losses, and ties). Include a clear title and axis labels. What are 2 - 3 observations you have from the plot?

6. *Does Portland have a home field advantage?* To explore this question, 

    - Create a new variable indicating whether Portland was the "home" or "away" team for each game. 
    - Create side-by-side box plots of the number of points scored by the Thorns based on whether or not they were the home team.  
    - Then create a ridge plot using `geom_density_ridges()`.
    - What are 2-3 observations you have from the visualizations? 

7. Continuing to investigate home-field advantage, produce a nicely formatted summary table that presents the proportion of games won, grouped by whether it was a home or away game.

*Do the number of points scored in a game change over the course of a season?* For example, do the points decrease, perhaps due to fatigue, or do they increase over a season as the team gets into a groove? To explore this question, let's first create a new variable called `game_number` that indicates the order of the game within a season (e.g., 1st, 2nd, 3rd, etc).

```{r, eval = FALSE}
portland <- portland %>% 
  group_by(season) %>% 
  arrange(game_date) %>% 
  mutate(game_number = row_number()) %>% 
  ungroup()
```

8. Create a scatterplot of the points Portland scored versus game number. However, use `geom_jitter()` instead of `geom_point()`. The function `geom_jitter()` adds some random noise to the points so they don't overlap each other.
    - Based on this plot, does there appear to be a general change in number of points scored over the course of the season? Briefly explain your response. 

9. Adapt your previous visualization to explore the relationship between points scored vs. game number, broken down by season. It's up to you to choose how best to visualize this - there is more than one appropriate answer. However, you should use `as.factor(season)` in the ggplot code, so `season` is treated as a categorical variable. 
    - Does there seem to be a difference in the pattern by season? Briefly explain your response. 

10. What is one additional question you could investigate using this data? This could be the `portland` data, the full `games` data, and/or the other data in the `nwslR` package. Provide a visualization and/or summary table that investigates your question. Interpret your results. 

# Submission 

# Submission

Before submitting, open up your .html in a full window and inspect the following:

+ Check your code for neatness - add spaces and line breaks where appropriate to improve readability

+ Check any visualizations for informative and clean labels and titles

+ Check any tables for clean formatting (e.g. with `kbl() %>% kable_minmal()`)

+ Check that you've interpreted output as appropriate

+ Make sure extraneous warnings and messages are suppressed (e.g. set warning = FALSE, message = FALSE)

+ Check that Exercises are clearly labeled and your text responses are visually distinguished

+ Check for overall neatness & organization of the report (e.g. headers, subheaders, use of bullets, font changes)

To submit, you need to export your .html document from RStudio Cloud and then upload it to the Exam 1 assignment on Canvas. Refer back to [Lab 01](https://kgfitzgerald.github.io/APU_MATH_250/labs/lab-01-hello-r.html) for detailed instructions on how to export and submit your assignment. Recall only one group member needs to submit the assignment.

# Grading (50 pts)

<br>

| Component | Points |
|:----------|:-------|
| Ex 1      | 2      |
| Ex 2      | 6    |
| Ex 3      | 6   |
| Ex 4      | 4   |
| Ex 5      | 6      |
| Ex 6      | 8    |
| Ex 7      | 6   |
| Ex 8      | 6    |
| Workflow & formatting   | 6      |

